<!DOCTYPE html>
<html>
<head>
<title>The Hobbit: Routine at 6C00</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="67AB.html">67AB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6c00">Map</a></td>
<td class="next">
Next: <a href="6CCD.html">6CCD</a>
</td>
</tr>
</table>
<div class="description">6C00: Game Entry Point</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="asm-label">Start</td>
<td class="address-2"><span id="6c00"></span>6C00</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6c01"></span>
<div class="comments">
<div class="paragraph">
Initial set-up; copies "clean" data to the "CopyOf..." store. This is then used to create a new game in <a href="6C00.html#6c27">ReStart</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c01"></span>6C01</td>
<td class="instruction">LD DE,$F400</td>
<td class="comment-1" rowspan="4">Copies <a href="C11B.html">Objects</a> to <a href="F400.html">CopyOfObjects</a> ($615 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c04"></span>6C04</td>
<td class="instruction">LD HL,$C11B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c07"></span>6C07</td>
<td class="instruction">LD BC,$0615</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c0a"></span>6C0A</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c0c"></span>6C0C</td>
<td class="instruction">LD HL,$BA8A</td>
<td class="comment-1" rowspan="3">Copies <a href="BA8A.html">Locations</a> to <a href="FA15.html">CopyOfLocations</a> ($5D9 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c0f"></span>6C0F</td>
<td class="instruction">LD BC,$05D9</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c12"></span>6C12</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c14"></span>6C14</td>
<td class="instruction">LD DE,$5F00</td>
<td class="comment-1" rowspan="4">Copies <a href="B6DA.html#b6eb">B6EB</a> to $5F00 ($1D bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c17"></span>6C17</td>
<td class="instruction">LD HL,$B6EB</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c1a"></span>6C1A</td>
<td class="instruction">LD BC,$001D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c1d"></span>6C1D</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c1f"></span>6C1F</td>
<td class="instruction">LD HL,$CA84</td>
<td class="comment-1" rowspan="3">Copies $CA84 to $5F1D ($BF bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c22"></span>6C22</td>
<td class="instruction">LD BC,$00BF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c25"></span>6C25</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6c27"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="82B3.html">82B3</a>, <a href="8451.html">LoadGame</a> and <a href="90D2.html">YouAreDead</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">ReStart</td>
<td class="address-2"><span id="6c27"></span>6C27</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c28"></span>6C28</td>
<td class="instruction">LD SP,$5EFF</td>
<td class="comment-1" rowspan="1">Set the stack pointer to <a href="5EFF.html">5EFF</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6c2b"></span>
<div class="comments">
<div class="paragraph">
Reset the border and paper colours for location <a href="BA8A.html#47804">$05</a> - "Trolls Clearing".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c2b"></span>6C2B</td>
<td class="instruction">LD IX,$CC00</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=<a href="CC00.html">LocGFXTable</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c2f"></span>6C2F</td>
<td class="instruction">LD A,$05</td>
<td class="comment-1" rowspan="2">Call <a href="9DBD.html">IndexIdTable</a> with location <a href="BA8A.html#47804">$05</a> - "Trolls Clearing".</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c31"></span>6C31</td>
<td class="instruction">CALL <a href="9DBD.html">IndexIdTable</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c34"></span>6C34</td>
<td class="instruction">LD L,(IX+$01)</td>
<td class="comment-1" rowspan="2"><span class="register">HL</span>=<a href="CC43.html#e142">E142</a> (<span class="register">HL</span>=location graphics data for "Trolls Clearing").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c37"></span>6C37</td>
<td class="instruction">LD H,(IX+$02)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c3a"></span>6C3A</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-1" rowspan="3">Write $00 (black) to the first (border) and second (paper) addresses.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c3c"></span>6C3C</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c3d"></span>6C3D</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6c3f"></span>
<div class="comments">
<div class="paragraph">
Copy "clean" data to the game tables ready for a new game.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c3f"></span>6C3F</td>
<td class="instruction">LD HL,$F400</td>
<td class="comment-1" rowspan="4">Copies <a href="F400.html">CopyOfObjects</a> to <a href="C11B.html">Objects</a> ($615 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c42"></span>6C42</td>
<td class="instruction">LD DE,$C11B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c45"></span>6C45</td>
<td class="instruction">LD BC,$0615</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c48"></span>6C48</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c4a"></span>6C4A</td>
<td class="instruction">LD DE,$BA8A</td>
<td class="comment-1" rowspan="3">Copies <a href="FA15.html">CopyOfLocations</a> to <a href="BA8A.html">Locations</a> ($5D9 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c4d"></span>6C4D</td>
<td class="instruction">LD BC,$05D9</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c50"></span>6C50</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c52"></span>6C52</td>
<td class="instruction">LD HL,$5F00</td>
<td class="comment-1" rowspan="4">Copies $5F00 to <a href="B6DA.html#b6eb">B6EB</a> ($1D bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c55"></span>6C55</td>
<td class="instruction">LD DE,$B6EB</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c58"></span>6C58</td>
<td class="instruction">LD BC,$001D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c5b"></span>6C5B</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c5d"></span>6C5D</td>
<td class="instruction">LD DE,$CA84</td>
<td class="comment-1" rowspan="3">Copies $CA84 to $5F1D ($BF bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c60"></span>6C60</td>
<td class="instruction">LD BC,$00BF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c63"></span>6C63</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c65"></span>6C65</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Set the border colour to black.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c66"></span>6C66</td>
<td class="instruction">OUT ($FE),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c68"></span>6C68</td>
<td class="instruction">LD A,$38</td>
<td class="comment-1" rowspan="2">Write $38 to <a href="https://skoolkid.github.io/rom/asm/5C48.html">BORDCR</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c6a"></span>6C6A</td>
<td class="instruction">LD ($5C48),A</td>
</tr>
<tr>
<td class="asm-label">ReStart_Keypress</td>
<td class="address-2"><span id="6c6d"></span>6C6D</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Read from the keyboard port.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c6e"></span>6C6E</td>
<td class="instruction">IN A,($FE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c70"></span>6C70</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">A pressed key from any line will set its respective bit; bit 0 (outer key) to bit 4 (inner key). Hence keep only bits 0-4 for the check.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c72"></span>6C72</td>
<td class="instruction">CP $1F</td>
<td class="comment-1" rowspan="2">Loop back to <a href="6C00.html#6c6d">ReStart_Keypress</a> until any key has been pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c74"></span>6C74</td>
<td class="instruction">JR Z,<a href="6C00.html#6c6d">ReStart_Keypress</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c76"></span>6C76</td>
<td class="instruction">LD A,$7F</td>
<td class="comment-1" rowspan="2">Read from the keyboard port. <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">$7F</td>
<td class="centre" colspan="1" rowspan="1">SPACE</td>
<td class="centre" colspan="1" rowspan="1">FULL-STOP</td>
<td class="centre" colspan="1" rowspan="1">M</td>
<td class="centre" colspan="1" rowspan="1">N</td>
<td class="centre" colspan="1" rowspan="1">B</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c78"></span>6C78</td>
<td class="instruction">IN A,($FE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c7a"></span>6C7A</td>
<td class="instruction">AND %00001000</td>
<td class="comment-1" rowspan="1">Keep bit 3 ("N").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c7c"></span>6C7C</td>
<td class="instruction">LD ($B707),A</td>
<td class="comment-1" rowspan="1">Write it to <a href="B6DA.html#b707">B707</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c7f"></span>6C7F</td>
<td class="instruction">LD HL,$50E0</td>
<td class="comment-1" rowspan="2">Write $50E0 to <a href="8576.html#85b4">the percentage buffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c82"></span>6C82</td>
<td class="instruction">LD ($85B4),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c85"></span>6C85</td>
<td class="instruction">LD A,$2B</td>
<td class="comment-1" rowspan="2">Write $2B to <a href="8576.html#85b4">$85B6</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c87"></span>6C87</td>
<td class="instruction">LD ($85B6),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c8a"></span>6C8A</td>
<td class="instruction">LD HL,$5020</td>
<td class="comment-1" rowspan="2">Write $5020 to <a href="869B.html#869c">869C</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c8d"></span>6C8D</td>
<td class="instruction">LD ($869C),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c90"></span>6C90</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="2">Write $01 to <a href="869B.html#869e">869E</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c92"></span>6C92</td>
<td class="instruction">LD ($869E),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c95"></span>6C95</td>
<td class="instruction">LD A,$20</td>
<td class="comment-1" rowspan="2">Write $20 to <a href="8576.html#85b3">85B3</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c97"></span>6C97</td>
<td class="instruction">LD ($85B3),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c9a"></span>6C9A</td>
<td class="instruction">LD A,$2A</td>
<td class="comment-1" rowspan="2">Write $2A to <a href="869B.html">869B</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c9c"></span>6C9C</td>
<td class="instruction">LD ($869B),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6c9f"></span>6C9F</td>
<td class="instruction">LD B,$C8</td>
<td class="comment-1" rowspan="3">Write $00 to C8 bytes, starting from <a href="B6DA.html#b738">B738</a> (using <a href="70E2.html">Blanker</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ca1"></span>6CA1</td>
<td class="instruction">LD HL,$B738</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ca4"></span>6CA4</td>
<td class="instruction">CALL <a href="70E2.html">Blanker</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ca7"></span>6CA7</td>
<td class="instruction">LD A,R</td>
<td class="comment-1" rowspan="2"><span class="register">R</span> = refresh register; i.e. write a semi-random number to <a href="B6DA.html#b70e">RandomSeed</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ca9"></span>6CA9</td>
<td class="instruction">LD ($B70E),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cac"></span>6CAC</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="6">Write $00 to; <ul class="">
<li><a href="869B.html#869f">869F</a></li>
<li><a href="869B.html#86a0">86A0</a></li>
<li><a href="B6DA.html#b71a">B71A</a></li>
<li><a href="B6DA.html#b700">B700</a></li>
<li><a href="B6DA.html#b6f2">B6F2</a></li>
</ul></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cad"></span>6CAD</td>
<td class="instruction">LD ($869F),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cb0"></span>6CB0</td>
<td class="instruction">LD ($86A0),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cb3"></span>6CB3</td>
<td class="instruction">LD ($B71A),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cb6"></span>6CB6</td>
<td class="instruction">LD ($B700),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cb9"></span>6CB9</td>
<td class="instruction">LD ($B6F2),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cbc"></span>6CBC</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="4">Write $01 to; <ul class="">
<li><a href="B6DA.html#b702">NightDay</a></li>
<li><a href="B6DA.html#b6fa">B6FA</a></li>
<li><a href="B6DA.html#b704">B704</a></li>
</ul></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cbe"></span>6CBE</td>
<td class="instruction">LD ($B702),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cc1"></span>6CC1</td>
<td class="instruction">LD ($B6FA),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cc4"></span>6CC4</td>
<td class="instruction">LD ($B704),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cc7"></span>6CC7</td>
<td class="instruction">LD HL,$0000</td>
<td class="comment-1" rowspan="2">Write $0000 to <a href="B6DA.html#b6f7">PercentageComplete</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6cca"></span>6CCA</td>
<td class="instruction">LD ($B6F7),HL</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="67AB.html">67AB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6c00">Map</a></td>
<td class="next">
Next: <a href="6CCD.html">6CCD</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1982 Melbourne House &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/hobbit/">Source code</a>.</div>
<div><a href="../dec/asm/27648.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>