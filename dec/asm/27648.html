<!DOCTYPE html>
<html>
<head>
<title>The Hobbit: Routine at 27648</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="26539.html">26539</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27648">Map</a></td>
<td class="next">
Next: <a href="27853.html">27853</a>
</td>
</tr>
</table>
<div class="description">27648: Game Entry Point</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="asm-label">Start</td>
<td class="address-2"><span id="27648"></span>27648</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27649"></span>
<div class="comments">
<div class="paragraph">
Initial set-up; copies "clean" data to the "CopyOf..." store. This is then used to create a new game in <a href="27648.html#27687">ReStart</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27649"></span>27649</td>
<td class="instruction">LD DE,62464</td>
<td class="comment-1" rowspan="4">Copies <a href="49435.html">Objects</a> to <a href="62464.html">CopyOfObjects</a> ($615 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27652"></span>27652</td>
<td class="instruction">LD HL,49435</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27655"></span>27655</td>
<td class="instruction">LD BC,1557</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27658"></span>27658</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27660"></span>27660</td>
<td class="instruction">LD HL,47754</td>
<td class="comment-1" rowspan="3">Copies <a href="47754.html">Locations</a> to <a href="64021.html">CopyOfLocations</a> ($5D9 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27663"></span>27663</td>
<td class="instruction">LD BC,1497</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27666"></span>27666</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27668"></span>27668</td>
<td class="instruction">LD DE,24320</td>
<td class="comment-1" rowspan="4">Copies <a href="46810.html#46827">46827</a> to $5F00 ($1D bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27671"></span>27671</td>
<td class="instruction">LD HL,46827</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27674"></span>27674</td>
<td class="instruction">LD BC,29</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27677"></span>27677</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27679"></span>27679</td>
<td class="instruction">LD HL,51844</td>
<td class="comment-1" rowspan="3">Copies $CA84 to $5F1D ($BF bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27682"></span>27682</td>
<td class="instruction">LD BC,191</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27685"></span>27685</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27687"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="33459.html">33459</a>, <a href="33873.html">LoadGame</a> and <a href="37074.html">YouAreDead</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">ReStart</td>
<td class="address-2"><span id="27687"></span>27687</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27688"></span>27688</td>
<td class="instruction">LD SP,24319</td>
<td class="comment-1" rowspan="1">Set the stack pointer to <a href="24319.html">24319</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27691"></span>
<div class="comments">
<div class="paragraph">
Reset the border and paper colours for location <a href="47754.html#47804">5</a> - "Trolls Clearing".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27691"></span>27691</td>
<td class="instruction">LD IX,52224</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=<a href="52224.html">LocGFXTable</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27695"></span>27695</td>
<td class="instruction">LD A,5</td>
<td class="comment-1" rowspan="2">Call <a href="40381.html">IndexIdTable</a> with location <a href="47754.html#47804">5</a> - "Trolls Clearing".</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27697"></span>27697</td>
<td class="instruction">CALL <a href="40381.html">IndexIdTable</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27700"></span>27700</td>
<td class="instruction">LD L,(IX+1)</td>
<td class="comment-1" rowspan="2"><span class="register">HL</span>=<a href="52291.html#57666">57666</a> (<span class="register">HL</span>=location graphics data for "Trolls Clearing").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27703"></span>27703</td>
<td class="instruction">LD H,(IX+2)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27706"></span>27706</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-1" rowspan="3">Write $00 (black) to the first (border) and second (paper) addresses.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27708"></span>27708</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27709"></span>27709</td>
<td class="instruction">LD (HL),0</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27711"></span>
<div class="comments">
<div class="paragraph">
Copy "clean" data to the game tables ready for a new game.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27711"></span>27711</td>
<td class="instruction">LD HL,62464</td>
<td class="comment-1" rowspan="4">Copies <a href="62464.html">CopyOfObjects</a> to <a href="49435.html">Objects</a> ($615 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27714"></span>27714</td>
<td class="instruction">LD DE,49435</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27717"></span>27717</td>
<td class="instruction">LD BC,1557</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27720"></span>27720</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27722"></span>27722</td>
<td class="instruction">LD DE,47754</td>
<td class="comment-1" rowspan="3">Copies <a href="64021.html">CopyOfLocations</a> to <a href="47754.html">Locations</a> ($5D9 bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27725"></span>27725</td>
<td class="instruction">LD BC,1497</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27728"></span>27728</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27730"></span>27730</td>
<td class="instruction">LD HL,24320</td>
<td class="comment-1" rowspan="4">Copies $5F00 to <a href="46810.html#46827">46827</a> ($1D bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27733"></span>27733</td>
<td class="instruction">LD DE,46827</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27736"></span>27736</td>
<td class="instruction">LD BC,29</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27739"></span>27739</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27741"></span>27741</td>
<td class="instruction">LD DE,51844</td>
<td class="comment-1" rowspan="3">Copies $CA84 to $5F1D ($BF bytes).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27744"></span>27744</td>
<td class="instruction">LD BC,191</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27747"></span>27747</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27749"></span>27749</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Set the border colour to black.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27750"></span>27750</td>
<td class="instruction">OUT (254),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27752"></span>27752</td>
<td class="instruction">LD A,56</td>
<td class="comment-1" rowspan="2">Write $38 to <a href="https://skoolkid.github.io/rom/asm/5C48.html">BORDCR</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27754"></span>27754</td>
<td class="instruction">LD (23624),A</td>
</tr>
<tr>
<td class="asm-label">ReStart_Keypress</td>
<td class="address-2"><span id="27757"></span>27757</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Read from the keyboard port.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27758"></span>27758</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27760"></span>27760</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">A pressed key from any line will set its respective bit; bit 0 (outer key) to bit 4 (inner key). Hence keep only bits 0-4 for the check.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27762"></span>27762</td>
<td class="instruction">CP 31</td>
<td class="comment-1" rowspan="2">Loop back to <a href="27648.html#27757">ReStart_Keypress</a> until any key has been pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27764"></span>27764</td>
<td class="instruction">JR Z,<a href="27648.html#27757">ReStart_Keypress</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27766"></span>27766</td>
<td class="instruction">LD A,127</td>
<td class="comment-1" rowspan="2">Read from the keyboard port. <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">$7F</td>
<td class="centre" colspan="1" rowspan="1">SPACE</td>
<td class="centre" colspan="1" rowspan="1">FULL-STOP</td>
<td class="centre" colspan="1" rowspan="1">M</td>
<td class="centre" colspan="1" rowspan="1">N</td>
<td class="centre" colspan="1" rowspan="1">B</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27768"></span>27768</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27770"></span>27770</td>
<td class="instruction">AND %00001000</td>
<td class="comment-1" rowspan="1">Keep bit 3 ("N").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27772"></span>27772</td>
<td class="instruction">LD (46855),A</td>
<td class="comment-1" rowspan="1">Write it to <a href="46810.html#46855">46855</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27775"></span>27775</td>
<td class="instruction">LD HL,20704</td>
<td class="comment-1" rowspan="2">Write $50E0 to <a href="34166.html#34228">the percentage buffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27778"></span>27778</td>
<td class="instruction">LD (34228),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27781"></span>27781</td>
<td class="instruction">LD A,43</td>
<td class="comment-1" rowspan="2">Write $2B to <a href="34166.html#34228">$85B6</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27783"></span>27783</td>
<td class="instruction">LD (34230),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27786"></span>27786</td>
<td class="instruction">LD HL,20512</td>
<td class="comment-1" rowspan="2">Write $5020 to <a href="34459.html#34460">34460</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27789"></span>27789</td>
<td class="instruction">LD (34460),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27792"></span>27792</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="2">Write $01 to <a href="34459.html#34462">34462</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27794"></span>27794</td>
<td class="instruction">LD (34462),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27797"></span>27797</td>
<td class="instruction">LD A,32</td>
<td class="comment-1" rowspan="2">Write $20 to <a href="34166.html#34227">34227</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27799"></span>27799</td>
<td class="instruction">LD (34227),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27802"></span>27802</td>
<td class="instruction">LD A,42</td>
<td class="comment-1" rowspan="2">Write $2A to <a href="34459.html">34459</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27804"></span>27804</td>
<td class="instruction">LD (34459),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27807"></span>27807</td>
<td class="instruction">LD B,200</td>
<td class="comment-1" rowspan="3">Write $00 to 200 bytes, starting from <a href="46810.html#46904">46904</a> (using <a href="28898.html">Blanker</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27809"></span>27809</td>
<td class="instruction">LD HL,46904</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27812"></span>27812</td>
<td class="instruction">CALL <a href="28898.html">Blanker</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27815"></span>27815</td>
<td class="instruction">LD A,R</td>
<td class="comment-1" rowspan="2"><span class="register">R</span> = refresh register; i.e. write a semi-random number to <a href="46810.html#46862">RandomSeed</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27817"></span>27817</td>
<td class="instruction">LD (46862),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27820"></span>27820</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="6">Write $00 to; <ul class="">
<li><a href="34459.html#34463">34463</a></li>
<li><a href="34459.html#34464">34464</a></li>
<li><a href="46810.html#46874">46874</a></li>
<li><a href="46810.html#46848">46848</a></li>
<li><a href="46810.html#46834">46834</a></li>
</ul></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27821"></span>27821</td>
<td class="instruction">LD (34463),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27824"></span>27824</td>
<td class="instruction">LD (34464),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27827"></span>27827</td>
<td class="instruction">LD (46874),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27830"></span>27830</td>
<td class="instruction">LD (46848),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27833"></span>27833</td>
<td class="instruction">LD (46834),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27836"></span>27836</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="4">Write $01 to; <ul class="">
<li><a href="46810.html#46850">NightDay</a></li>
<li><a href="46810.html#46842">46842</a></li>
<li><a href="46810.html#46852">46852</a></li>
</ul></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27838"></span>27838</td>
<td class="instruction">LD (46850),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27841"></span>27841</td>
<td class="instruction">LD (46842),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27844"></span>27844</td>
<td class="instruction">LD (46852),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27847"></span>27847</td>
<td class="instruction">LD HL,0</td>
<td class="comment-1" rowspan="2">Write $0000 to <a href="46810.html#46839">PercentageComplete</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="27850"></span>27850</td>
<td class="instruction">LD (46839),HL</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="26539.html">26539</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27648">Map</a></td>
<td class="next">
Next: <a href="27853.html">27853</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1982 Melbourne House &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/hobbit/">Source code</a>.</div>
<div><a href="../../asm/6C00.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>